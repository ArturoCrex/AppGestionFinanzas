import{u as z,d as O,r as c,j as e}from"./index-BIJJ6zyg.js";import{o as R,p as G,q as H,r as J}from"./dataService-DkYNsTWt.js";import{f as p}from"./formatCurrency-CNSA3FR6.js";import{s as h}from"./shared.module-DtX0B0CA.js";const K="_active_1utda_79",L="_preview_1utda_187",M="_completed_1utda_255",Q="_paid_1utda_333",i={"split-form":"_split-form_1utda_1","form-row":"_form-row_1utda_25","split-toggle":"_split-toggle_1utda_49",active:K,"participants-section":"_participants-section_1utda_93","participant-input":"_participant-input_1utda_117","remove-btn":"_remove-btn_1utda_135","add-person":"_add-person_1utda_159",preview:L,"bills-list":"_bills-list_1utda_219","bill-card":"_bill-card_1utda_231",completed:M,"bill-header":"_bill-header_1utda_265","bill-icon":"_bill-icon_1utda_281","bill-total":"_bill-total_1utda_289","participants-list":"_participants-list_1utda_299","participant-row":"_participant-row_1utda_307",paid:Q,"bill-actions":"_bill-actions_1utda_343"};function Z(){const{t:l}=z(),o=O(t=>t.currency),[b,P]=c.useState([]),[_,N]=c.useState(!1),[g,y]=c.useState(""),[d,B]=c.useState(0),[w,A]=c.useState("restaurant"),[r,x]=c.useState(["",""]),[u,j]=c.useState([0,0]),[m,C]=c.useState("equal");c.useEffect(()=>{v()},[]);async function v(){try{const t=await R();P(t)}catch(t){console.error("Error loading split bills:",t)}}function q(){x([...r,""]),j([...u,0])}function E(t){r.length<=2||(x(r.filter((s,a)=>a!==t)),j(u.filter((s,a)=>a!==t)))}function T(t,s){const a=[...r];a[t]=s,x(a)}function k(t,s){const a=[...u];a[t]=s,j(a)}const f=r.filter(t=>t.trim()).length,S=f>0?d/f:0;async function I(){if(!g||d<=0||r.some(a=>!a.trim()))return;const t=r.filter(a=>a.trim()),s={title:g,totalAmount:d,category:w,createdAt:new Date,participants:t.map((a,n)=>({id:crypto.randomUUID(),name:a.trim(),amount:m==="equal"?S:u[n]||0,paid:!1}))};try{await G(s),N(!1),y(""),B(0),x(["",""]),j([0,0]),await v()}catch(a){console.error("Error creating split bill:",a)}}async function D(t,s){const a=t.participants.map(n=>n.id===s?{...n,paid:!n.paid}:n);try{await H(t.id,{participants:a},t.supabaseId),await v()}catch(n){console.error("Error toggling paid:",n)}}async function F(t){try{await J(t.id,t.supabaseId),await v()}catch(s){console.error("Error deleting bill:",s)}}function U(t){const a=[`ğŸ“‹ ${t.title}`,`ğŸ’° ${l("splitBill.total")}: ${p(t.totalAmount,o)}`,"",...t.participants.map(n=>`${n.paid?"âœ…":"â¬œ"} ${n.name}: ${p(n.amount,o)}`)].join(`
`);navigator.share?navigator.share({title:t.title,text:a}):navigator.clipboard.writeText(a)}const $={restaurant:"ğŸ½ï¸",leisure:"ğŸ‰",transport:"ğŸš—",shopping:"ğŸ›ï¸",other:"ğŸ“Œ"};return e.jsxs("div",{className:h.page,children:[e.jsxs("div",{className:h["page-header"],children:[e.jsx("h2",{children:l("splitBill.title")}),e.jsx("button",{className:h["btn-primary"],onClick:()=>N(!_),children:_?l("common.cancel"):`+ ${l("splitBill.add")}`})]}),_&&e.jsxs("div",{className:i["split-form"],children:[e.jsxs("div",{className:i["form-row"],children:[e.jsx("label",{children:l("splitBill.billTitle")}),e.jsx("input",{type:"text",value:g,onChange:t=>y(t.target.value),placeholder:l("splitBill.titlePlaceholder")})]}),e.jsxs("div",{className:i["form-row"],children:[e.jsx("label",{children:l("splitBill.totalAmount")}),e.jsx("input",{type:"number",value:d||"",onChange:t=>B(Number(t.target.value)),placeholder:"0.00",min:"0",step:"0.01"})]}),e.jsxs("div",{className:i["form-row"],children:[e.jsx("label",{children:l("splitBill.category")}),e.jsx("select",{value:w,onChange:t=>A(t.target.value),children:Object.entries($).map(([t,s])=>e.jsxs("option",{value:t,children:[s," ",l(`categories.${t}`)]},t))})]}),e.jsxs("div",{className:i["form-row"],children:[e.jsx("label",{children:l("splitBill.splitType")}),e.jsxs("div",{className:i["split-toggle"],children:[e.jsx("button",{className:m==="equal"?i.active:"",onClick:()=>C("equal"),children:l("splitBill.equal")}),e.jsx("button",{className:m==="custom"?i.active:"",onClick:()=>C("custom"),children:l("splitBill.custom")})]})]}),e.jsxs("div",{className:i["participants-section"],children:[e.jsx("label",{children:l("splitBill.participants")}),r.map((t,s)=>e.jsxs("div",{className:i["participant-input"],children:[e.jsx("input",{type:"text",value:t,onChange:a=>T(s,a.target.value),placeholder:`${l("splitBill.person")} ${s+1}`,style:{flex:m==="custom"?2:1}}),m==="custom"&&e.jsx("input",{type:"number",value:u[s]||"",onChange:a=>k(s,Number(a.target.value)),placeholder:"0.00",min:"0",step:"0.01",style:{flex:1,textAlign:"right"}}),r.length>2&&e.jsx("button",{className:i["remove-btn"],onClick:()=>E(s),children:"âœ•"})]},s)),e.jsxs("button",{className:i["add-person"],onClick:q,children:["+ ",l("splitBill.addPerson")]})]}),d>0&&f>0&&e.jsxs("div",{className:i.preview,children:[e.jsxs("span",{children:[l("splitBill.perPerson"),":"]}),e.jsx("strong",{children:m==="equal"?p(S,o):p(u.reduce((t,s)=>t+s,0),o)+` / ${p(d,o)}`})]}),e.jsx("button",{className:h["btn-primary"],onClick:I,children:l("splitBill.create")})]}),b.length===0&&!_?e.jsxs("div",{className:h["empty-state"],children:[e.jsx("span",{style:{fontSize:"3rem"},children:"ğŸ‘¥"}),e.jsx("p",{children:l("splitBill.noBills")})]}):e.jsx("div",{className:i["bills-list"],children:b.map(t=>{const s=t.participants.every(a=>a.paid);return e.jsxs("div",{className:`${i["bill-card"]} ${s?i.completed:""}`,children:[e.jsxs("div",{className:i["bill-header"],children:[e.jsxs("div",{children:[e.jsx("span",{className:i["bill-icon"],children:$[t.category]||"ğŸ“Œ"}),e.jsx("strong",{children:t.title})]}),e.jsx("span",{className:i["bill-total"],children:p(t.totalAmount,o)})]}),e.jsx("div",{className:i["participants-list"],children:t.participants.map(a=>e.jsxs("div",{className:`${i["participant-row"]} ${a.paid?i.paid:""}`,onClick:()=>D(t,a.id),children:[e.jsxs("span",{children:[a.paid?"âœ…":"â¬œ"," ",a.name]}),e.jsx("span",{children:p(a.amount,o)})]},a.id))}),e.jsxs("div",{className:i["bill-actions"],children:[e.jsxs("button",{onClick:()=>U(t),children:["ğŸ“¤ ",l("splitBill.share")]}),e.jsxs("button",{onClick:()=>F(t),children:["ğŸ—‘ï¸ ",l("common.delete")]})]})]},t.id)})})]})}export{Z as default};
