import{u as H,d as K,r as o,j as a}from"./index-BIJJ6zyg.js";import{e as M,f as D,h as Y,i as _,j as z,k as J}from"./dataService-DkYNsTWt.js";import{f as N}from"./formatCurrency-CNSA3FR6.js";import{a as G}from"./dateHelpers-CV5MkOD6.js";import{s as r}from"./shared.module-DtX0B0CA.js";function Z(){const{t:s}=H(),i=K(e=>e.currency),[v,R]=o.useState([]),[E,F]=o.useState(!0),[l,x]=o.useState(!1),[n,k]=o.useState(null),[g,b]=o.useState(null),[d,A]=o.useState(0),[I,h]=o.useState([]),[c,f]=o.useState(""),[u,y]=o.useState(0),[j,w]=o.useState(""),[m,S]=o.useState("ðŸŽ¯"),W=["ðŸŽ¯","âœˆï¸","ðŸ ","ðŸš—","ðŸ’»","ðŸ“±","ðŸŽ“","ðŸ’","ðŸ¥","ðŸ’°","ðŸŽ®","ðŸ¶"];o.useEffect(()=>{p()},[]);async function p(){try{const e=await M();R(e)}catch(e){console.error("Error loading saving goals:",e)}finally{F(!1)}}function C(){f(""),y(0),w(""),S("ðŸŽ¯"),k(null),x(!1)}function B(e){k(e),f(e.name),y(e.targetAmount),w(new Date(e.deadline).toISOString().slice(0,10)),S(e.icon||"ðŸŽ¯"),x(!0)}async function O(){if(!c.trim()||u<=0)return;const e=new Date;try{n?.id?await D(n.id,{name:c.trim(),targetAmount:u,deadline:new Date(j),icon:m,updatedAt:e},n.supabaseId):await Y({name:c.trim(),targetAmount:u,currentAmount:0,currency:i,deadline:new Date(j),icon:m,color:"",createdAt:e,updatedAt:e}),C(),await p()}catch(t){console.error("Error saving goal:",t)}}async function T(e){try{await _(e.id,e.supabaseId),e.id&&await z.savingContributions.where("goalId").equals(e.id).delete(),C(),await p()}catch(t){console.error("Error deleting goal:",t)}}async function q(e){const t=e.id||e.supabaseId;if(t){b(t),A(0);try{if(e.id){const $=await z.savingContributions.where("goalId").equals(e.id).reverse().sortBy("date");h($)}else h([])}catch{h([])}}}async function L(){if(!(!g||d<=0))try{const e=v.find(t=>(t.id||t.supabaseId)===g);if(!e)return;await D(e.id,{currentAmount:e.currentAmount+d,updatedAt:new Date},e.supabaseId),e.id&&await J({goalId:e.id,amount:d,date:new Date,note:""}),b(null),await p()}catch(e){console.error("Error contributing:",e)}}return E?a.jsx("div",{className:r["empty-state"],children:a.jsx("div",{className:"animate-pulse",children:s("common.loading")})}):a.jsxs("div",{className:r.page,children:[a.jsxs("div",{className:r["page-header"],children:[a.jsx("h2",{children:s("savings.title")}),a.jsx("button",{className:r["btn-primary"],onClick:()=>{C(),x(!l)},children:l?s("common.cancel"):`ï¼‹ ${s("savings.add")}`})]}),l&&a.jsxs("div",{style:{background:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"var(--space-lg)",display:"flex",flexDirection:"column",gap:"var(--space-md)"},children:[a.jsx("h3",{style:{margin:0},children:s(n?"common.edit":"savings.add")}),a.jsx("div",{style:{display:"flex",gap:"var(--space-xs)",flexWrap:"wrap"},children:W.map(e=>a.jsx("button",{onClick:()=>S(e),style:{width:40,height:40,fontSize:20,borderRadius:"var(--radius-md)",border:m===e?"2px solid var(--color-primary)":"1px solid var(--color-border)",background:m===e?"rgba(99,102,241,0.1)":"var(--color-bg)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e},e))}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:s("savings.goal")}),a.jsx("input",{type:"text",value:c,onChange:e=>f(e.target.value),placeholder:s("savings.goal"),style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:s("transactions.amount")}),a.jsx("input",{type:"number",value:u||"",onChange:e=>y(Number(e.target.value)),placeholder:"0.00",min:"0",step:"0.01",style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:s("savings.deadline")}),a.jsx("input",{type:"date",value:j,onChange:e=>w(e.target.value),style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),a.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[a.jsx("button",{className:r["btn-primary"],onClick:O,style:{flex:1},children:s("common.save")}),(n?.id||n?.supabaseId)&&a.jsx("button",{onClick:()=>T(n),style:{padding:"var(--space-sm) var(--space-lg)",borderRadius:"var(--radius-md)",background:"rgba(239,68,68,0.1)",color:"var(--color-danger)",fontWeight:600},children:s("common.delete")})]})]}),g&&a.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"var(--space-lg)"},children:a.jsxs("div",{style:{background:"var(--color-surface)",borderRadius:"var(--radius-xl)",padding:"var(--space-xl)",maxWidth:400,width:"100%",display:"flex",flexDirection:"column",gap:"var(--space-md)"},children:[a.jsx("h3",{style:{margin:0},children:s("savings.contribute")}),a.jsx("input",{type:"number",value:d||"",onChange:e=>A(Number(e.target.value)),placeholder:"0.00",min:"0",step:"0.01",autoFocus:!0,style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)",fontSize:"var(--font-size-lg)"}}),I.length>0&&a.jsxs("div",{style:{maxHeight:150,overflowY:"auto",fontSize:"var(--font-size-sm)"},children:[a.jsxs("p",{style:{color:"var(--color-text-muted)",marginBottom:"var(--space-xs)"},children:[s("savings.history"),":"]}),I.slice(0,10).map(e=>a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0",borderBottom:"1px solid var(--color-border)"},children:[a.jsx("span",{children:G(e.date)}),a.jsxs("span",{style:{color:"var(--color-success)",fontWeight:600},children:["+",N(e.amount,i)]})]},e.id))]}),a.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[a.jsx("button",{className:r["btn-primary"],onClick:L,style:{flex:1},children:s("savings.contribute")}),a.jsx("button",{onClick:()=>b(null),style:{padding:"var(--space-sm) var(--space-lg)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"},children:s("common.close")})]})]})}),v.length===0&&!l?a.jsxs("div",{className:r["empty-state"],children:[a.jsx("span",{className:r["empty-icon"],children:"ðŸ·"}),a.jsx("p",{className:r["empty-text"],children:s("savings.noGoals")})]}):a.jsx("div",{className:r["card-list"],children:v.map(e=>{const t=e.targetAmount>0?Math.min(e.currentAmount/e.targetAmount*100,100):0;return a.jsxs("div",{className:r.card,style:{flexDirection:"column",alignItems:"stretch",gap:"var(--space-sm)"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs("div",{className:r["card-left"],onClick:()=>B(e),style:{cursor:"pointer"},children:[a.jsx("div",{className:r["card-icon"],children:e.icon||"ðŸŽ¯"}),a.jsxs("div",{className:r["card-info"],children:[a.jsx("span",{className:r["card-title"],children:e.name}),a.jsxs("span",{className:r["card-subtitle"],children:[s("savings.deadline"),": ",G(e.deadline)]})]})]}),a.jsxs("div",{style:{textAlign:"right"},children:[a.jsxs("div",{className:r["card-amount"],children:[N(e.currentAmount,i)," / ",N(e.targetAmount,i)]}),a.jsxs("button",{onClick:()=>q(e),style:{marginTop:4,padding:"2px var(--space-sm)",fontSize:"var(--font-size-xs)",borderRadius:"var(--radius-full)",background:"var(--color-primary)",color:"white",fontWeight:600},children:["+ ",s("savings.contribute")]})]})]}),a.jsx("div",{className:r["progress-bar"],children:a.jsx("div",{className:r["progress-fill"],style:{width:`${t}%`}})}),a.jsxs("span",{className:r["progress-text"],children:[t.toFixed(0),"%"]})]},e.id)})})]})}export{Z as default};
