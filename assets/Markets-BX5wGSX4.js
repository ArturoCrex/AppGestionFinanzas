import{u as D,d as P,r as l,j as e}from"./index-BIJJ6zyg.js";import{f as u}from"./formatCurrency-CNSA3FR6.js";import{s as p}from"./shared.module-DtX0B0CA.js";const F="https://open.er-api.com/v6/latest";async function N(t="EUR"){try{const c=await(await fetch(`${F}/${t}`)).json();return{base:c.base_code,rates:c.rates,updatedAt:new Date(c.time_last_update_utc)}}catch(r){return console.error("Error fetching forex rates:",r),{base:t,rates:{},updatedAt:new Date}}}const O="https://api.coingecko.com/api/v3";async function M(t=["bitcoin","ethereum","solana","cardano","polkadot"],r="eur"){try{const c=t.join(","),m=await(await fetch(`${O}/coins/markets?vs_currency=${r}&ids=${c}&order=market_cap_desc&sparkline=false`)).json();return Array.isArray(m)?m.map(o=>({id:o.id,symbol:o.symbol.toUpperCase(),name:o.name,price:o.current_price,change24h:o.price_change_percentage_24h,marketCap:o.market_cap,image:o.image})):[]}catch(c){return console.error("Error fetching crypto prices:",c),[]}}async function L(t="EUR"){try{const c=(await N("USD")).rates[t]||1;return[{name:"Oro",symbol:"XAU",pricePerOz:5057*c,change24h:0,currency:t},{name:"Plata",symbol:"XAG",pricePerOz:78*c,change24h:0,currency:t},{name:"Platino",symbol:"XPT",pricePerOz:2077*c,change24h:0,currency:t}]}catch(r){return console.error("Error fetching metal prices:",r),[]}}const w="M4044FH4DK1TUM5Y";async function f(t){try{const n=(await(await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${t}&apikey=${w}`)).json())["Global Quote"];return!n||!n["05. price"]?null:{symbol:n["01. symbol"],name:t,price:parseFloat(n["05. price"]),change:parseFloat(n["09. change"]),changePercent:parseFloat(n["10. change percent"]?.replace("%","")||"0"),currency:"USD"}}catch(r){return console.error("Error fetching stock quote:",r),null}}async function B(t){try{return((await(await fetch(`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${t}&apikey=${w}`)).json()).bestMatches||[]).map(m=>({symbol:m["1. symbol"],name:m["2. name"]}))}catch{return[]}}const G="_tabs_mo81q_3",T="_tab_mo81q_3",X="_active_mo81q_53",Q="_change_mo81q_263",z="_positive_mo81q_273",H="_negative_mo81q_281",K="_suggestions_mo81q_321",s={tabs:G,tab:T,active:X,"data-grid":"_data-grid_mo81q_67","data-card":"_data-card_mo81q_79","data-pair":"_data-pair_mo81q_107","data-price":"_data-price_mo81q_125","data-detail":"_data-detail_mo81q_139","metal-icon":"_metal-icon_mo81q_149",change:Q,positive:z,negative:H,"stocks-section":"_stocks-section_mo81q_291","stock-search":"_stock-search_mo81q_303",suggestions:K,"suggestion-item":"_suggestion-item_mo81q_339","stock-card":"_stock-card_mo81q_371","stock-header":"_stock-header_mo81q_387","stock-name":"_stock-name_mo81q_397","stock-price":"_stock-price_mo81q_407","big-price":"_big-price_mo81q_421","carousel-wrapper":"_carousel-wrapper_mo81q_433","carousel-track":"_carousel-track_mo81q_445","carousel-card":"_carousel-card_mo81q_475","carousel-coin-img":"_carousel-coin-img_mo81q_519","carousel-coin-name":"_carousel-coin-name_mo81q_545","carousel-coin-symbol":"_carousel-coin-symbol_mo81q_557","carousel-coin-price":"_carousel-coin-price_mo81q_571","carousel-arrow":"_carousel-arrow_mo81q_587","carousel-arrow-left":"_carousel-arrow-left_mo81q_651","carousel-arrow-right":"_carousel-arrow-right_mo81q_659"};function V(){const{t}=D(),r=P(a=>a.currency),[c,n]=l.useState("forex"),[m,o]=l.useState(!1),[_,S]=l.useState(null),[h,q]=l.useState([]),[C,U]=l.useState([]),[g,x]=l.useState(""),[i,b]=l.useState(null),[j,k]=l.useState([]),d=l.useRef(null);l.useEffect(()=>{A(c)},[c,r]);async function A(a){o(!0);try{switch(a){case"forex":S(await N(r));break;case"crypto":q(await M(void 0,r.toLowerCase()));break;case"metals":U(await L(r));break}}catch(y){console.error("Error loading market data:",y)}o(!1)}async function v(){if(!g.trim())return;o(!0);const a=await f(g.toUpperCase());b(a),o(!1)}async function E(a){if(x(a),a.length>=2){const y=await B(a);k(y.slice(0,5))}else k([])}const R=[{key:"forex",icon:"ðŸ’±",label:t("markets.forex")},{key:"crypto",icon:"â‚¿",label:t("markets.crypto")},{key:"metals",icon:"ðŸ¥‡",label:t("markets.metals")},{key:"stocks",icon:"ðŸ“ˆ",label:t("markets.stocks")}],$=["USD","EUR","GBP","JPY","CHF","CAD","AUD","MXN","BRL","ARS","COP","CLP"];return e.jsxs("div",{className:p.page,children:[e.jsx("h2",{children:t("markets.title")}),e.jsx("div",{className:s.tabs,children:R.map(a=>e.jsxs("button",{className:`${s.tab} ${c===a.key?s.active:""}`,onClick:()=>n(a.key),children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.label})]},a.key))}),m?e.jsxs("div",{className:p["empty-state"],children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:t("common.loading")})]}):e.jsxs(e.Fragment,{children:[c==="forex"&&_&&e.jsx("div",{className:s["data-grid"],children:$.filter(a=>a!==r).map(a=>e.jsxs("div",{className:s["data-card"],children:[e.jsx("div",{className:s["data-pair"],children:e.jsxs("strong",{children:[r,"/",a]})}),e.jsx("div",{className:s["data-price"],children:_.rates[a]?.toFixed(4)||"â€”"}),e.jsxs("div",{className:s["data-detail"],children:["1 ",r," = ",_.rates[a]?.toFixed(2)," ",a]})]},a))}),c==="crypto"&&e.jsxs("div",{className:s["carousel-wrapper"],children:[h.length>0&&e.jsx("button",{className:`${s["carousel-arrow"]} ${s["carousel-arrow-left"]}`,onClick:()=>{d.current&&d.current.scrollBy({left:-280,behavior:"smooth"})},"aria-label":"Previous",children:"â€¹"}),e.jsx("div",{className:s["carousel-track"],ref:d,children:h.map(a=>e.jsxs("div",{className:s["carousel-card"],children:[e.jsx("img",{src:a.image,alt:a.name,className:s["carousel-coin-img"]}),e.jsx("strong",{className:s["carousel-coin-name"],children:a.name}),e.jsx("span",{className:s["carousel-coin-symbol"],children:a.symbol.toUpperCase()}),e.jsx("span",{className:s["carousel-coin-price"],children:u(a.price,r)}),e.jsxs("span",{className:`${s.change} ${a.change24h>=0?s.positive:s.negative}`,children:[a.change24h>=0?"â–²":"â–¼"," ",Math.abs(a.change24h).toFixed(2),"%"]})]},a.id))}),h.length>0&&e.jsx("button",{className:`${s["carousel-arrow"]} ${s["carousel-arrow-right"]}`,onClick:()=>{d.current&&d.current.scrollBy({left:280,behavior:"smooth"})},"aria-label":"Next",children:"â€º"}),h.length===0&&e.jsx("div",{className:p["empty-state"],children:e.jsx("p",{children:t("markets.noData")})})]}),c==="metals"&&e.jsx("div",{className:s["data-grid"],children:C.map(a=>e.jsxs("div",{className:s["data-card"],children:[e.jsxs("div",{className:s["data-pair"],children:[e.jsx("span",{className:s["metal-icon"],children:a.symbol==="XAU"?"ðŸ¥‡":a.symbol==="XAG"?"ðŸ¥ˆ":"ðŸ’Ž"}),e.jsx("strong",{children:a.name})]}),e.jsx("div",{className:s["data-price"],children:u(a.pricePerOz,r)}),e.jsx("div",{className:s["data-detail"],children:t("markets.perOunce")})]},a.symbol))}),c==="stocks"&&e.jsxs("div",{className:s["stocks-section"],children:[e.jsxs("div",{className:s["stock-search"],children:[e.jsx("input",{type:"text",value:g,onChange:a=>E(a.target.value),placeholder:t("markets.searchStock"),onKeyDown:a=>a.key==="Enter"&&v()}),e.jsx("button",{className:p["btn-primary"],onClick:v,children:t("common.search")})]}),j.length>0&&e.jsx("div",{className:s.suggestions,children:j.map(a=>e.jsxs("button",{className:s["suggestion-item"],onClick:()=>{x(a.symbol),k([]),f(a.symbol).then(b)},children:[e.jsx("strong",{children:a.symbol})," â€” ",a.name]},a.symbol))}),i&&e.jsxs("div",{className:s["stock-card"],children:[e.jsxs("div",{className:s["stock-header"],children:[e.jsx("h3",{children:i.symbol}),e.jsx("span",{className:s["stock-name"],children:i.name})]}),e.jsxs("div",{className:s["stock-price"],children:[e.jsx("span",{className:s["big-price"],children:u(i.price,i.currency)}),e.jsxs("span",{className:`${s.change} ${i.change>=0?s.positive:s.negative}`,children:[i.change>=0?"â–²":"â–¼"," ",u(Math.abs(i.change),i.currency)," (",Math.abs(i.changePercent).toFixed(2),"%)"]})]})]})]})]})]})}export{V as default};
