import{u as $,d as F,r as o,j as r}from"./index-BIJJ6zyg.js";import{b as M,l as C,m as T,n as W}from"./dataService-DkYNsTWt.js";import{f as D}from"./formatCurrency-CNSA3FR6.js";import{a as G}from"./dateHelpers-CV5MkOD6.js";import{s as a}from"./shared.module-DtX0B0CA.js";const B={"ðŸ“º":"TV / Streaming","ðŸŽµ":"MÃºsica","â˜ï¸":"Cloud","ðŸŽ®":"Gaming","ðŸ“±":"App","ðŸ“°":"Noticias","ðŸ‹ï¸":"Gym","ðŸš—":"Transporte","ðŸ“¦":"Otros","ðŸ’¡":"Servicios","ðŸ”’":"Seguridad","ðŸ“š":"EducaciÃ³n"};function J(){const{t}=$(),m=F(e=>e.currency),[i,z]=o.useState([]),[I,E]=o.useState(!0),[c,v]=o.useState(!1),[n,N]=o.useState(null),[l,x]=o.useState(""),[d,y]=o.useState(0),[g,f]=o.useState("monthly"),[h,b]=o.useState(new Date().toISOString().slice(0,10)),[w,k]=o.useState("subscription"),[p,j]=o.useState("ðŸ“¦");o.useEffect(()=>{u()},[]);async function u(){try{const e=await M();z(e)}catch(e){console.error("Error loading subscriptions:",e)}finally{E(!1)}}function S(){x(""),y(0),f("monthly"),b(new Date().toISOString().slice(0,10)),k("subscription"),j("ðŸ“¦"),N(null),v(!1)}function R(e){N(e),x(e.name),y(e.amount),f(e.frequency),b(new Date(e.nextPayment).toISOString().slice(0,10)),k(e.category),j(e.icon||"ðŸ“¦"),v(!0)}async function A(){if(!l.trim()||d<=0)return;const e=new Date;try{n?.id?await C(n.id,{name:l.trim(),amount:d,frequency:g,nextPayment:new Date(h),category:w,icon:p,updatedAt:e},n.supabaseId):await T({name:l.trim(),amount:d,currency:m,frequency:g,nextPayment:new Date(h),category:w,icon:p,active:!0,createdAt:e,updatedAt:e}),S(),await u()}catch(s){console.error("Error saving subscription:",s)}}async function P(e){try{await W(e.id,e.supabaseId),S(),await u()}catch(s){console.error("Error deleting subscription:",s)}}async function q(e){if(!(!e.id&&!e.supabaseId))try{await C(e.id,{active:!e.active,updatedAt:new Date},e.supabaseId),await u()}catch(s){console.error("Error toggling subscription:",s)}}const O=i.filter(e=>e.active).reduce((e,s)=>s.frequency==="weekly"?e+s.amount*4.33:s.frequency==="yearly"?e+s.amount/12:e+s.amount,0);return I?r.jsx("div",{className:a["empty-state"],children:r.jsx("div",{className:"animate-pulse",children:t("common.loading")})}):r.jsxs("div",{className:a.page,children:[r.jsxs("div",{className:a["page-header"],children:[r.jsx("h2",{children:t("subscriptions.title")}),r.jsx("button",{className:a["btn-primary"],onClick:()=>{S(),v(!c)},children:c?t("common.cancel"):`ï¼‹ ${t("subscriptions.add")}`})]}),i.length>0&&r.jsxs("div",{style:{padding:"var(--space-md) var(--space-lg)",background:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{color:"var(--color-text-muted)",fontSize:"var(--font-size-sm)"},children:t("subscriptions.totalMonthly")}),r.jsx("span",{style:{fontWeight:700,fontSize:"var(--font-size-xl)"},children:D(O,m)})]}),c&&r.jsxs("div",{style:{background:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-lg)",padding:"var(--space-lg)",display:"flex",flexDirection:"column",gap:"var(--space-md)"},children:[r.jsx("h3",{style:{margin:0},children:t(n?"common.edit":"subscriptions.add")}),r.jsx("div",{style:{display:"flex",gap:"var(--space-xs)",flexWrap:"wrap"},children:Object.keys(B).map(e=>r.jsx("button",{onClick:()=>j(e),style:{width:40,height:40,fontSize:20,borderRadius:"var(--radius-md)",border:p===e?"2px solid var(--color-primary)":"1px solid var(--color-border)",background:p===e?"rgba(99,102,241,0.1)":"var(--color-bg)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e},e))}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[r.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:"Nombre"}),r.jsx("input",{type:"text",value:l,onChange:e=>x(e.target.value),placeholder:"Netflix, Spotify...",style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),r.jsxs("div",{style:{display:"flex",gap:"var(--space-md)"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",flex:1},children:[r.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:t("transactions.amount")}),r.jsx("input",{type:"number",value:d||"",onChange:e=>y(Number(e.target.value)),placeholder:"0.00",min:"0",step:"0.01",style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px",flex:1},children:[r.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:t("subscriptions.frequency")}),r.jsxs("select",{value:g,onChange:e=>f(e.target.value),style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"},children:[r.jsx("option",{value:"weekly",children:t("subscriptions.weekly")}),r.jsx("option",{value:"monthly",children:t("subscriptions.monthly")}),r.jsx("option",{value:"yearly",children:t("subscriptions.yearly")})]})]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[r.jsx("label",{style:{fontSize:"var(--font-size-sm)",color:"var(--color-text-muted)"},children:t("subscriptions.nextPayment")}),r.jsx("input",{type:"date",value:h,onChange:e=>b(e.target.value),style:{padding:"var(--space-sm) var(--space-md)",borderRadius:"var(--radius-md)",border:"1px solid var(--color-border)",background:"var(--color-bg)",color:"var(--color-text)"}})]}),r.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[r.jsx("button",{className:a["btn-primary"],onClick:A,style:{flex:1},children:t("common.save")}),(n?.id||n?.supabaseId)&&r.jsx("button",{onClick:()=>P(n),style:{padding:"var(--space-sm) var(--space-lg)",borderRadius:"var(--radius-md)",background:"rgba(239,68,68,0.1)",color:"var(--color-danger)",fontWeight:600},children:t("common.delete")})]})]}),i.length===0&&!c?r.jsxs("div",{className:a["empty-state"],children:[r.jsx("span",{className:a["empty-icon"],children:"ðŸ”„"}),r.jsx("p",{className:a["empty-text"],children:t("subscriptions.noSubscriptions")})]}):r.jsx("div",{className:a["card-list"],children:i.map(e=>r.jsxs("div",{className:a.card,children:[r.jsxs("div",{className:a["card-left"],onClick:()=>R(e),style:{cursor:"pointer"},children:[r.jsx("div",{className:a["card-icon"],children:e.icon||"ðŸ“¦"}),r.jsxs("div",{className:a["card-info"],children:[r.jsx("span",{className:a["card-title"],children:e.name}),r.jsxs("span",{className:a["card-subtitle"],children:[t(`subscriptions.${e.frequency}`)," Â· ",t("subscriptions.nextPayment"),": ",G(e.nextPayment)]})]})]}),r.jsxs("div",{className:a["card-right"],children:[r.jsx("span",{className:`${a["card-amount"]} ${a.expense}`,children:D(e.amount,m)}),r.jsx("div",{className:`${a["card-badge"]} ${e.active?a.active:a.inactive}`,onClick:()=>q(e),style:{cursor:"pointer"},children:e.active?t("subscriptions.active"):t("subscriptions.inactive")})]})]},e.id))})]})}export{J as default};
